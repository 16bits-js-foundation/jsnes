<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <title>JSNES</title>
    <script src="jquery-1.2.6.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="jquery.dimensions.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="utils.js" type="text/javascript" charset="utf-8"></script>
    <script src="cpu.js" type="text/javascript" charset="utf-8"></script>
    <script src="cpuinfo.js" type="text/javascript" charset="utf-8"></script>
    <script src="globals.js" type="text/javascript" charset="utf-8"></script>
    <script src="keyboard.js" type="text/javascript" charset="utf-8"></script>
    <script src="mappers.js" type="text/javascript" charset="utf-8"></script>
    <script src="nametable.js" type="text/javascript" charset="utf-8"></script>
    <script src="nes.js" type="text/javascript" charset="utf-8"></script>
    <script src="palettetable.js" type="text/javascript" charset="utf-8"></script>
    <script src="ppu.js" type="text/javascript" charset="utf-8"></script>
    <script src="rom.js" type="text/javascript" charset="utf-8"></script>
    <script src="roms.js" type="text/javascript" charset="utf-8"></script>
    <script src="tile.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript" charset="utf-8">
        var nes;
        var roms = {};
        
        $(document).ready(function() {
            $("#status").text("Initialising...");
            $("<option>Select a ROM...</option>").appendTo("#roms");
            for (c in roms_list) {
                var optgroup = $('<optgroup></optgroup>').attr("label", c);
                for (i in roms_list[c]) if (roms_list[c].hasOwnProperty(i)) {
                    $('<option>'+roms_list[c][i]+'</option>')
                        .attr("value", roms_list[c][i])
                        .appendTo(optgroup);
                }
                $("#roms").append(optgroup);
            }
            nes = new NES();
        });
    </script>
    <style type="text/css" media="screen">
        #screen {
            float:left;
            margin-right: 50px;
        }
    </style>
</head>

<body>
<h1>JSNES</h1>

<canvas id="screen" width="256" height="240"></canvas>

<!--<p><strong>Status:</strong> <span id="status">Loading...</span></p>-->
<input type="button" value="pause" id="pause" disabled="disabled" />
<input type="button" value="restart" id="restart" disabled="disabled" />

<p><select id="roms"></select></p>

<script type="text/javascript" charset="utf-8">
    // Mouse events
    $("#screen").mousedown(function(e){
        if (nes && nes.memMapper) {
            nes.memMapper.mousePressed = true;
            nes.memMapper.mouseX = e.pageX-$("#screen").offset()["left"];
            nes.memMapper.mouseY = e.pageY-$("#screen").offset()["top"];
        }
    });
    
    $("#screen").mouseup(function(){
        if (nes && nes.memMapper) {
            nes.memMapper.mousePressed = false;
            nes.memMapper.mouseX = 0;
            nes.memMapper.mouseY = 0;
        }
    });
    
    function resetButtons() {
        $("#pause").attr("disabled", null).attr("value", "pause");
        $("#restart").attr("disabled", null);
    }
    
    $("#roms").change(function() {
        resetButtons();
        var romName = $("#roms").val();
        $("#status").text("Downloading "+romName);
        $.getScript("roms/"+escape(romName)+".js", function(){
            nes.loadRom(romName);
            nes.start();
        });
    });
    
    $("#pause").click(function() {
        b = $("#pause");
        if (b.attr("value") == "pause") {
            nes.stop();
            b.attr("value", "resume");
        }
        else {
            nes.start();
            b.attr("value", "pause");
        }
    });
    
    $("#restart").click(function() {
        nes.reloadRom();
        nes.start();
    });
    
</script>

</body>
</html>
